// lib/controllers/fadel_al_duaa_getx_controller.dart

import 'package:get/get.dart'; // استيراد GetX
import 'package:rokenalmuslem/data/database/database_helper.dart';

class FadelAlDuaaGetXController extends GetxController {
  // استخدام RxList و RxBool لإدارة الحالة التفاعلية مع GetX
  final RxList<Map<String, dynamic>> _duas = <Map<String, dynamic>>[].obs;
  final RxBool _isLoading = false.obs;

  List<Map<String, dynamic>> get duas => _duas.value;
  bool get isLoading => _isLoading.value;

  // قائمة الأدعية الأولية (التي كانت موجودة في الكود الثابت)
  // الآن على شكل List<Map<String, dynamic>> مباشرةً
  final List<Map<String, dynamic>> initialDuasData = [
    {
      "title": "معنى الدعاء :",
      "content":
          "الدعاء هو أن يطلبَ الداعي ما ينفعُه وما يكشف ضُرَّه؛ وحقيقته إظهار الافتقار إلى الله، والتبرؤ من الحول والقوة، وهو سمةُ العبوديةِ، واستشعارُ الذلةِ البشرية، وفيه معنى الثناءِ على الله عز وجل، وإضافةِ الجود والكرم إليه.",
      "iconName": "lightbulb_outline",
    },
    {
      "title": "الدعاءُ طاعةٌ لله، وامتثال لأمره : ",
      "content":
          "قال تعالى: ﴿وَقَالَ رَبُّكُمُ ادْعُونِي أَسْتَجِبْ لَكُمْ إِنَّ الَّذِينَ يَسْتَكْبِرُونَ عَنْ عِبَادَتِي سَيَدْخُلُونَ جَهَنَّمَ دَاخِرِينَ﴾. [سورة غافر: الآية 60]",
      "iconName": "check_circle_outline",
    },
    {
      "title": "الدعاء عبادة :",
      "content":
          "قال صَلَّى اللَّهُ عَلَيْهِ وَسَلَّمَ : الدُّعَاءُ هُوَ الْعِبَادَةُ. [رواه الترمذي وابن ماجه، وصححه الألباني]",
      "iconName": "self_improvement",
    },
    {
      "title": "الدعاء أكرم شيء على الله تعالى :",
      "content":
          "قال صَلَّى اللَّهُ عَلَيْهِ وَسَلَّمَ : لَيْسَ شَيْءٌ أَكْرَمَ عَلَى اللَّهِ تَعَالَى مِنْ الدُّعَاءِ. [رواه أحمد والبخاري، وابن ماجة، والترمذي والحاكم وصححه، ووافقه الذهبي]",
      "iconName": "star_border",
    },
    {
      "title": "الدعاء سبب لدفع غضب الله :",
      "content":
          "قال صَلَّى اللَّهُ عَلَيْهِ وَسَلَّمَ: مَنْ لَمْ يَسْأَلْ اللَّهَ يَغْضَبْ عَلَيْهِ. [رواه الترمذيُّ، وابن ماجةَ، وصححه الحاكم، ووافقه الذهبي، وحسنه الألباني]",
      "iconName": "gpp_good_outlined",
    },
    {
      "title": "الدعاء سلامة من العجز، ودليل على الكَياسة :",
      "content":
          "قال صَلَّى اللَّهُ عَلَيْهِ وَسَلَّمَ: أَعْجَزُ النَّاسِ مَنْ عَجَزَ عَنْ الدُّعَاءِ وَأَبْخَلُ النَّاسِ مَنْ بَخِلَ بِالسَّلَامِ. [رواه ابن حبان وصححه الألباني]",
      "iconName": "fitness_center_outlined",
    },
    {
      "title": "الدعاء سبب لرفع البلاء :",
      "content":
          "قال صَلَّى اللَّهُ عَلَيْهِ وَسَلَّمَ: مَنْ فُتِحَ لَهُ مِنْكُمْ بَابُ الدُّعَاءِ فُتِحَتْ لَهُ أَبْوَابُ الرَّحْمَةِ وَمَا سُئِلَ اللَّهُ شَيْئًا يَعْنِي أَحَبَّ إِلَيْهِ مِنْ أَنْ يُسْأَلَ الْعَافِيَةَ وَقَالَ رَسُولُ اللَّهِ صَلَّى اللَّهم عَلَيْهِ وَسَلَّمَ إِنَّ الدُّعَاءَ يَنْفَعُ مِمَّا نَزَلَ وَمِمَّا لَمْ يَنْزِلْ فَعَلَيْكُمْ عِبَادَ اللَّهِ بِالدُّعَاءِ. [رواه الترمذي وحسنه الألباني ]",
      "iconName": "shield_outlined",
    },
    {
      "title": "الداعي في معيةُ الله :",
      "content":
          "قال رَسُولُ اللَّهِ صَلَّى اللَّهُ عَلَيْهِ وَسَلَّمَ: يقول الله عز وجل: أَنَا عِنْدَ ظَنِّ عَبْدِي بِي وَأَنَا مَعَهُ إِذَا دَعَانِي . [رواه مسلم] .",
      "iconName": "waving_hand",
    },
    {
      "title": "فضل الدعاء في السجود :",
      "content":
          "قال صَلَّى اللَّهُ عَلَيْهِ وَسَلَّمَ: أَقْرَبُ مَا يَكُونُ الْعَبْدُ مِنْ رَبِّهِ عَزَّ وَجَلَّ وَهُوَ سَاجِدٌ ، فَأَكْثِرُوا الدُّعَاءَ . [رواه مسلم] .",
      "iconName": "mosque_rounded",
    },
    {
      "title": "فضل الدعاء بالليل :",
      "content":
          "قال صَلَّى اللَّهُ عَلَيْهِ وَسَلَّمَ: إِنَّ فِي اللَّيْلِ لَسَاعَةٌ لَا يُوَافِقُهَا رَجُلٌ مُسْلِمٌ يَسْأَلُ اللَّهَ تَعَالَى مِنْ أَمْرِ الدُّنْيَا وَالْآخِرَةِ إِلَّا أَعْطَاهُ إِيَّاهُ وَذَلِكَ كُلَّ لَيْلَةٍ . [رواه مسلم]",
      "iconName": "nightlight_round",
    },
    {
      "title": "فضل الدعاء للمسلمين بظهر الغيب :",
      "content":
          "قال صَلَّى اللَّهُ عَلَيْهِ وَسَلَّمَ: مَا مِنْ عَبْدٍ مُسْلِمٍ يَدْعُو لِأَخِيهِ بِظَهْرِ الْغَيْبِ إِلَّا قَالَ الْمَلَكُ : وَلَكَ بِمِثْلٍ . [رواه مسلم]",
      "iconName": "people_outline",
    },
  ];

  @override
  void onInit() {
    super.onInit();
    loadFadelAlDuas(); // جلب البيانات عند تهيئة الكنترولر
  }

  Future<void> loadFadelAlDuas() async {
    _isLoading.value = true; // تحديث حالة التحميل
    try {
      await DatabaseHelper.instance;
      final data = await DatabaseHelper.instance.getAllFadelAlDuas();
      _duas.assignAll(data); // تحديث قائمة الأدعية بشكل تفاعلي
    } catch (e) {
      print('Error loading Fadel Al-Duaa: $e');
      // يمكنك هنا إضافة منطق لعرض رسالة خطأ للمستخدم
    } finally {
      _isLoading.value = false; // تحديث حالة التحميل
    }
  }
}
