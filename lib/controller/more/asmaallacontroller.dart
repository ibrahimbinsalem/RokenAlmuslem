// controller/asma_allah_controller.dart

import 'package:get/get.dart';
import 'package:flutter/material.dart'; // Needed for Get.bottomSheet
import 'package:rokenalmuslem/data/database/database_helper.dart'; // Adjust path as needed

class AsmaAllahController extends GetxController {
  final DatabaseHelper _dbHelper = DatabaseHelper();

  // RxList to hold the Asma Allah items
  final RxList<Map<String, dynamic>> items = <Map<String, dynamic>>[].obs;

  // Initial static list of Asma Allah
  final List<Map<String, dynamic>> _initialStaticAsmaAllah = [
    {"name": "الله", "dis": "عَلَمٌ على الذات الإلهية، الاسم الأعظم الذي تفرد به الحق سبحانه."},
    {"name": "الرَّحْمن", "dis": " كثير الرحمة، اسم مقصور عليه فلا يقال لغيره، يرحم بجلائل النعم."},
    {"name": "الرَّحِيم", "dis": "المنعم أبدًا، المتفضل دومًا، فرحمته لا تنتهي، يرحم بدقائق النّعم."},
    {"name": "المَلِك", "dis": "ملك الملوك، له الملك، مالك يوم الدين، مليك الخلق، فهو المالك المطلق."},
    {"name": "الْقُدُّوس", "dis": " الطاهر المنزه عن العيوب والنقائص، وعن كل ما تحيط به العقول."},
    {"name": "السَّلَام", "dis": " ناشر السلام بين الأنام، سلمت ذاته من النقص والعيب والفناء."},
    {"name": "المُؤْمِن", "dis": "سلَّم أوليائه من عذابه، ويُصدق عباده ما وعدهم."},
    {"name": "الْمُهَيْمِن", "dis": "الحافظ لكل شيء، القائم على خلقه، والمطلع على خفايا الأمور، وخبايا الصدور."},
    {"name": "الْعَزِيز", "dis": "المنفرد بالعزة، الظاهر الذي لا يُقهر، القوي الممتنع غالب كل شيء."},
    {"name": "الْجَبَّار", "dis": "تنفذ مشيئته، ولا يخرج أحد عن تقديره، القاهر لخلقه على ما أراد."},
    {"name": "الْمُتَكَبِّر", "dis": " المتعالي عن صفات الخلق، المنفرد بالعظمة والكبرياء."},
    {"name": "الْخَالِق", "dis": "المبدع لكل شيء والمُقدّر له، الموجد للأشياء من العدم، خالق كل صانع وصنعته."},
    {"name": "الْبَارِئ", "dis": "خلق الخلق بقدرته لا عن مثال سابق، القادر على إبراز ما قدره إلى الوجود."},
    {"name": "الْمُصَوِّر", "dis": "أعطى كل موجود صورة خاصة تمّيزه، وهيئة منفردة، على اختلاف الموجودات وكثرتها."},
    {"name": "اَلْغَفَّار", "dis": " يغفر الذنوب ويستر العيوب في الدنيا والآخرة."},
    {"name": "الْقَهَّار", "dis": " الغالب الذي قهر خلقه بسلطانه وقدرته، وخضعت له الرقاب، وذلت له الجبابرة، وصرف خلقه على ما أراد طوعًا وكرهًا، وعنت الوجوه له."},
    {"name": "الْوَهَّاب", "dis": " المنعم على العباد، يهب بغير عوض، ويعطي الحاجة بغير سؤال، كثير النعم، دائم العطاء."},
    {"name": "الرَّزَّاق", "dis": "خلق الأرزاق، وأعطى كل الخلائق أرزاقها، ويمد كل كائن لما يحتاجه، ويحفظ عليه حياته."},
    {"name": "الْفَتَّاح", "dis": " يفتح مغلق الأمور، ويسهل العسير، وبيده مفاتيح السماوات والأرض."},
    {"name": "الْعَلِيم", "dis": "يعلم تفاصيل الأمور، ودقائق الأشياء، وخفايا الضمائر، والنفوس، لا يعزب عنه مثقال ذرة، فعلمه يحيط بجميع الأشياء."},
    {"name": "الْقَابِضُ", "dis": "يقبض الرزق عمن يشاء من الخلق بعدله وحكمته."},
    {"name": "الْبَاسِطُ", "dis": " يوسّعُ الرزق لمن يشاء من عباده بجوده ورحمته."},
    {"name": "الخافض", "dis": "يخفض كل من طغى وتجبر وخرج على شريعته وتمرّد."},
    {"name": "الرَّافِعُ", "dis": "يرفع عباده المؤمنين بالطاعات، ويرفعهم على عدوهم فينصرهم، وهو رافع السماوات السبع."},
    {"name": "المُعزّ", "dis": "هب القوة والغلبة والشدة لمن شاء فيعزه."},
    {"name": "المُذلّ", "dis": "ينزع القوة والغلبة والشّدة عمن يشاء فيذله."},
    {"name": "السَّمِيعُ", "dis": "سمعه لجميع الأصوات الظاهرة والباطنة الخفية والجلية، وإحاطته التامة بها، وسمع السائلين والداعين والعابدين، ويجيبهم ويثيبهم."},
    {"name": "الْبَصِير", "dis": "يرى الأشياء كلها ظاهرها وباطنها، المحيط بكل شيء علمًا."},
    {"name": "الْحَكَم", "dis": " يفصل بين مخلوقاته بما شاء، ويفصل بين الحق والباطل، لا راد لقضائه، ولا معقب لحكمه."},
    {"name": "العدل", "dis": "حرَّم الظلم على نفسه، وجعله على عباده محرما، فهو المنزه عن الظلم والجور في أحكامه وأفعاله، يعطي كل ذي حق حقه."},
    {"name": "اللَّطِيفُ", "dis": "الرفيق بعباده، يرزق وييسر ويحسن إليهم، ويرفق بهم ويتفضل عليهم."},
    {"name": "الْخَبِيرُ", "dis": "العليم بدقائق الأمور، لا تخفى عليه خافية، ولا يغيب عن علمه شيء، العالم بما كان ويكون."},
    {"name": "الْحَلِيمُ", "dis": "يمهل ولا يهمل، ويستر الذنوب، ويؤخر العقوبة، فيرزق العاصي كما يرزق المطيع."},
    {"name": "الْعَظِيمُ", "dis": "العظيم في كل شيء، عظيم في ذاته وأسمائه وصفاته، فلا أحد يساويه، ولا عظيم يدانيه."},
    {"name": "الْغَفُورُ", "dis": " الساتر لذنوب عباده المتجاوز عن خطاياهم وذنوبهم، الفرق بين هذا الاسم واسم الغفار: أنّ اسم الغفور يكون للدلالة على مغفرة الذنب مهما عظم وأيس صاحبه من المغفرة، أمّا الغفار فتدل على مغفرة الله المستمرة للذنوب المختلفة لأن الإنسان خطاء فالله غفار."},
    {"name": "الشَّكُورُ", "dis": "يزكو عنده القليل من أعمال العباد، فيتقبلها ويضاعف أجرها."},
    {"name": "الْعَلِيُّ", "dis": "الرفيع القدر فلا يحيط به وصف الواصفين، المتعالي عن الأنداد والأضداد، فكل معاني العلو ثابتة له ذاتًا وقهرًا وشأنًا."},
    {"name": "الْكَبِيرُ", "dis": " العظيم الجليل ذو الكبرياء في صفاته وأفعاله، فلا يحتاج إلى شيء، ولا يعجزه شيء."},
    {"name": "الْحَفِيظُ", "dis": " لا يغرب عن حفظه شيء ولو كمثقال الذر، فحفظه لا يتبدل ولا يزول ولا يعتريه التبديل."},
    {"name": "المُقِيت", "dis": " المتكفل بإيصال أقوات الخلق إليهم، وهو الحفيظ والمقتدر والقدير والمقدر والممدد."},
    {"name": "الْحَسِيبُ", "dis": "الكافي الذي منه كفاية العباد، عليه الاعتماد يكفي العباد بفضله."},
    {"name": "الجليل", "dis": "العظيم المطلق المتصف بجميع صفات الكمال، والمنعوت بكمالها، المنزه عن كل نقص."},
    {"name": "الْكَرِيمُ", "dis": " الكثير الخير، الجواد المعطي الذي لا ينفد عطاؤه، وهو الكريم المطلق، الجامع لأنواع الخير والشرف والفضائل، المحمود بفعاله."},
    {"name": "الرَّقِيبُ", "dis": " يراقب أحوال العباد، ويعلم أقوالهم، ويحصي أعمالهم، وهو الحافظ الذي لا يغيب عنه شيء."},
    {"name": "الْمُجِيبُ", "dis": "يجيب دعاء من دعاه، وسؤال من سأله، ويقابله بالعطاء والقبول، ولا يُسأل أحد سواه."},
    {"name": "الْوَاسِعُ", "dis": "وسع رزقه جميع خلقه، وسعت رحمته كل شيء، المحيط بكل شيء."},
    {"name": "اَلْحَكِيمُ", "dis": "المُحق في تدبيره، اللطيف في تقديره، الخبير بحقائق الأمور، العليم بحكمه المقدور في جميع خلقه، وقضاءه خير وحكمه وعدل."},
    {"name": "الْوَدُودُ", "dis": "المحب لعباده، والمحبوب في قلوب أوليائه."},
    {"name": "الْمَجِيدُ", "dis": " تمجَّد بفعاله، ومجَّده خلقه لعظمته، والمجيد هو واسع الكرم، ووصف نفسه بالمجيد وهو متضمن كثرة صفات كماله وسعتها، وعدم إحصاء الخلق لها، وسعة أفعاله وكثرة خيره ودوامه، وتعني أيضاً البالغ النهاية في المجد، الكثير الإحسان الجزيل العطاء العظيم البر."},
    {"name": "الباعث", "dis": "باعث الخلق يوم القيامة، وباعث رسله إلى العباد، وباعث المعونة إلى العبد."},
    {"name": "الشَّهِيدُ", "dis": "الحاضر الذي لا يغيب عنه شيء، فهو المطلع على كل شيء مشاهد له عليم بتفاصيله."},
    {"name": "الْحَقُّ", "dis": "يحق الحق بكلماته، ويؤيد أولياءه، فهو المستحق للعبادة."},
    {"name": "الْوَكِيلُ", "dis": "الكفيل بالخلق القائم بأمورهم، فمن توكل عليه تولاه وكفاه، ومن استغنى به أغناه وأرضاه."},
    {"name": "الْقَوِيّ", "dis": "صاحب القدرة التامة البالغة الكمال، غالب لا يُغلب فقوته فوق كل قوة، ولا يرد قضاءه راد، ينفذ أمره، ويمضي قضاؤه في خلقه، شديد عقابه لمن كفر بآياته وجحد حججه."},
    {"name": "الْمَتِينُ", "dis": "الشديد الذي لا يحتاج في إمضاء حكمه إلى جند أو مدد ولا معين، فهو المتناهي في القوة، لا تلحق أفعاله مشقة، ولا يمسه فيها لغوب."},
    {"name": "الْوَلِيُّ", "dis": " المحب الناصر لمن أطاعه، ينصر أولياءه، ويقهر أعداءه، والمتولي لأمور الخلائق."},
    {"name": "الْحَمِيدُ", "dis": "المستحق للحمد والثناء؛ على ذاته وصفاته وعلى نعمه التي لا تحصى."},
    {"name": "الْـمُحْصِي", "dis": " أحصى كل شيء بعلمه، فلا يفوته منها دقيق ولا جليل."},
    {"name": "المبدئ", "dis": "أنشأ الأشياء، واخترعها ابتداء من غير سابق مثال."},
    {"name": "المعيد", "dis": "يعيد الخلق بعد الحياة إلى الممات في الدنيا، وبعد الممات إلى الحياة يوم القيامة."},
    {"name": "المُحيي", "dis": "خالق الحياة ومعطيها لمن شاء، يحيي الخلق من العدم ثم يحييهم بعد الموت."},
    {"name": "المميت", "dis": "مقدر الموت على كل من أماته ولا مميت سواه، قهر عباده بالموت متى شاء وكيف شاء"},
    {"name": "الْحَيُّ", "dis": "المتصف بالحياة الأبدية التي لا بداية لها ولا نهاية، الباقي أزلًا وأبدًا، الحيّ الذي لا يموت."},
    {"name": "الْقَيُّومُ", "dis": "القائم بنفسه، الغني عن غيره، القائم بتدبير أمر خلقه في إنشائهم ورزقهم."},
    {"name": "الواجد", "dis": " لا يعوزه شيء ولا يعجزه شيء، يجد كل ما يطلبه، ويدرك كل ما يريده."},
    {"name": "الماجد", "dis": "له الكمال المتناهي والعز الباهي، له العز في الأوصاف والأفعال، يعامل العباد بالجود."},
    {"name": "الْوَاحِدُ", "dis": "الفرد المتفرد في ذاته وصفاته وأفعاله، واحد في ملكه لا ينازعه أحد، لا شريك له سبحانه."},
    {"name": "الصَّمَدُ", "dis": "المطاع لا يقضى دونه أمر، يُقصد إليه في الحوائج، مقصد عباده في مهمات دينهم ودنياهم"},
    {"name": "الْقَادِرُ", "dis": " يقدر على إيجاد المعدوم وإعدام الموجود على قدر ما تقتضي الحكمة، لا زائدًا عليه ولا ناقصًا عنه."},
    {"name": "الْمُقْتَدِرُ", "dis": "يقدر على إصلاح الخلائق على وجه لا يقدر عليه غيره."},
    {"name": "الْمُقَدِّمُ", "dis": "يقدم الأشياء ويضعها في مواضعها، فمن استحق التقديم قدمه."},
    {"name": "الْمُؤَخِّرُ", "dis": "يؤخر الأشياء فيضعها في مواضعها، المؤخر لمن شاء من الفجار والكفار وكل من يستحق التأخير."},
    {"name": "الْأَوَّلُ", "dis": "لم يسبقه في الوجود شيء، فهو أول قبل الوجود."},
    {"name": "الْآخِرُ", "dis": "الباقي بعد فناء خلقه، البقاء الأبدي، يفنى الكل وله البقاء وحده، فليس بعده شيء."},
    {"name": "الظَّاهِرُ", "dis": "ظهر فوق كل شيء وعلا عليه، الظاهر وجوده لكثرة دلائله."},
    {"name": "الْبَاطِنُ", "dis": "العالم ببواطن الأمور وخفاياها، وهو أقرب إلينا من حبل الوريد."},
    {"name": "الوالي", "dis": " المالك للأشياء المتصرف فيها بمشيئته وحكمته، ينفذ فيها أمره، ويجري عليها حكمه."},
    {"name": "الْمُتَعَالِ", "dis": " جلّ عن إفك المفترين، وتنزه عن وساوس المتحيرين."},
    {"name": "الْبَرُّ", "dis": " العطوف على عباده ببره ولطفه، مَنَّ على السائلين بحسن عطائه، وصدقهم فيما وعد."},
    {"name": "التَّوَّابُ", "dis": "يوفق عباده للتوبة حتى يتوب عليهم، ويقبل توبتهم فيقابل الدعاء بالعطاء، والتوبة بالغفران."},
    {"name": "الْمُنْتَقِمُ", "dis": "يقصم ظهور الطغاة، ويشدد العقوبة على العصاة، وذلك بعد الإعذار والإنذار."},
    {"name": "العَفُو", "dis": "يترك المؤاخذة على الذنوب ولا يذكرك بالعيوب، فهو يمحو السيئات ويتجاوز عن المعاصي."},
    {"name": "الرَّؤُوفُ", "dis": " المتعطف على المذنبين بالتوبة، جادَ بلطفه ومَنّ بتعطفه، يستر العيوب ثم يعفو عنها."},
    {"name": "مَالِكُ الْمُلْكِ", "dis": " المتصرف في ملكه كيف يشاء لا رادّ لحكمه، ولا معقب لأمره."},
    {"name": "ذُو الْجَلَالِ والْإكْرَامِ", "dis": "المنفرد بصفات الجلال والكمال والعظمة، المختص بالإكرام والكرامة وهو أهل لأن يُجلّ."},
    {"name": "المقسط", "dis": " العادل في حكمه، الذي ينتصف للمظلوم من الظالم، ثم يكمل عدله فيرضي الظالم بعد إرضاء المظلوم."},
    {"name": "الْجَامِعُ", "dis": "جمع الكمالات كلها، ذاتًا ووصفًا وفعلًا، يجمع بين الخلائق المتماثلة والمتباينة، ويجمع الأولين والآخرين."},
    {"name": "الْغَنِيُّ", "dis": "لا يحتاج إلى شيء، وهو المستغني عن كل ما سواه، المفتقر إليه كل من عاداه."},
    {"name": "المغني", "dis": " معطي الغنى لعباده، يغني من يشاء غناه، وهو الكافي لمن شاء من عباده."},
    {"name": "الْمُعْطِي", "dis": "أعطى كل شيء."},
    {"name": "المانع", "dis": "يمنع العطاء عمّن يشاء ابتلاءً أو حماية."},
    {"name": "الضارّ", "dis": " المقدر للضّر على من أراد كيف أراد."},
    {"name": "النافع", "dis": " المقدر النفع والخير لمن أراد كيف أراد."},
    {"name": "النُّورُ", "dis": "الهادي الرشيد الذي يرشد بهدايته من يشاء فيبين له الحق، ويلهمه اتباعه، الظاهر في ذاته، المظهر لغيره."},
    {"name": "الْهَادِي", "dis": " المبين للخلق طريق الحق بكلامه، يهدي القلوب إلى معرفته، والنفوس إلى طاعته."},
    {"name": "الْبَدِيعُ", "dis": " لا يماثله أحد في صفاته، ولا في حكم من أحكامه، أو أمر من أموره، فهو المحدث الموجد على غير مثال."},
    {"name": "الباقي", "dis": "وحده له البقاء، الدائم الوجود الموصوف بالبقاء الأزلي، غير قابل للفناء فهو الباقي بلا انتهاء."},
    {"name": "الْوَارِثُ", "dis": " الأبقى الدائم الذي يرث الخلائق بعد فناء الخلق، وهو يرث الأرض ومن عليها."},
    {"name": "الرشيد", "dis": " أسعد من شاء بإرشاده، وأشقى من شاء بإبعاده، عظيم الحكمة بالغ الرشاد."},
    {"name": "الصبور", "dis": " الحليم الذي لا يعاجل العصاة بالنقمة، بل يعفوا ويؤخر، ولا يسرع بالفعل قبل أوانه."}
  ];

  @override
  void onInit() {
    super.onInit();
    _loadAsmaAllahFromDatabase();
  }

  Future<void> _loadAsmaAllahFromDatabase() async {
    final List<Map<String, dynamic>> asmaAllah = await _dbHelper.getAllAsmaAllah();

    if (asmaAllah.isEmpty) {
      print("Database table '${DatabaseHelper.asmaAllahTableName}' is empty. Inserting initial data...");
      // Insert initial data with IDs
      int idCounter = 1;
      for (var nameData in _initialStaticAsmaAllah) {
        await _dbHelper.insertAsmaAllah(
          {
            'id': idCounter++,
            'name': nameData['name'],
            'dis': nameData['dis'],
          },
        );
      }
      // Reload data after insertion
      await _loadAsmaAllahFromDatabase();
    } else {
      items.clear();
      for (var dbName in asmaAllah) {
        items.add({
          "id": dbName['id'],
          "name": dbName['name'],
          "dis": dbName['dis'],
        });
      }
      print("Asma Allah loaded from database for '${DatabaseHelper.asmaAllahTableName}'.");
    }
  }

  void showDescriptionBottomSheet(BuildContext context, String name, String dis) {
    Get.bottomSheet(
      Container(
        height: 250, // Increased height for better readability
        width: double.infinity,
        decoration: BoxDecoration(
          color: Colors.grey[900],
          borderRadius: const BorderRadius.only(
            topLeft: Radius.circular(30),
            topRight: Radius.circular(30),
          ),
        ),
        child: Column(
          children: [
            Padding(
              padding: const EdgeInsets.all(15.0),
              child: Text(
                name,
                style: const TextStyle(
                  color: Colors.white,
                  fontSize: 28, // Larger font size for the name
                  fontWeight: FontWeight.bold,
                  fontFamily: 'Tajawal',
                ),
                textAlign: TextAlign.center,
                textDirection: TextDirection.rtl,
              ),
            ),
            Expanded(
              child: SingleChildScrollView(
                padding: const EdgeInsets.only(right: 20, left: 20, bottom: 20),
                child: Text(
                  dis,
                  style: const TextStyle(
                    color: Colors.white70,
                    fontSize: 18,
                    fontFamily: 'Tajawal',
                    height: 1.5,
                  ),
                  textAlign: TextAlign.justify, // Justify text for better appearance
                  textDirection: TextDirection.rtl,
                ),
              ),
            ),
          ],
        ),
      ),
      isScrollControlled: true, // Allow content to be scrollable if it exceeds height
      enableDrag: true, // Enable dragging to dismiss
    );
  }
}